<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="dstyle.css" />
  <title>Document</title>
</head>

<body>
  <div class="container">
    <div class="row">
    </div>
  </div>
  <div class="container my-3"><button class="btn btn-danger" id="priceArr">가격정렬</button></div>
  <div class="container my-3"><button class="btn btn-danger" id="namereturn">가나다 역순 정렬</button></div>
  <div class="container my-3"><button class="btn btn-danger" id="priceUnder">6만원 이하</button></div>
  <div class="container my-3"><button class="btn btn-danger" id="moreData">더보기</button></div>

  <script>
    //구매버튼을 누르면 장바구니에 상품명추가 실제 서비스면 서버로 보냈을듯함
    //데이터를 저장할 다른 공간을 만들어야하는데 가장 쉬운 곳은 변수인데 단점은 변수는 페이지 재로드시 초기화됨
    //데이터 영구적으로 저장하기에 적합하지 않음
    //반영구적으로 저장할 수 있는 방법이 있는데 그게 로컬스토리지임
    //브라우저에 저장할 수 있는 방법중
    //로컬스토리지랑 세션스토리지는 가장 쉽게 키: 밸류 형태로 데이터를 저장할 수있음
    //인덱스DB는 데이터가 크고 복잡하다 구조화된 대용량데이터 저장시 사용
    //쿠키는 보통로그인 정보 저장(인증정보)
    //캐시스토리지는 htms css js 파일 저장하는 곳임
    //로컬스토리지랑 세션스토리지 용량은 5MB 문자/숫자만 저장가능함 arr,obj 못넣음 넣으려고하면 강제로 문자열로바꿔줌
    //그런데 둘의 차이는 로컬스토리지는 사이트재접속해도 유지됨 세션스토리지는 사이트나가면 자동삭제됨
    //데이터를 저장하는 방법
    // localStorage.setItem('데이터이름', '데이터값')
    //데이터를 뽑고 싶다?
    // localStorage.getItem('데이터이름')
    //로컬스토리지 데이터를 삭제하고싶다?
    // localStorage.removeItem('데이터이름')
    //편법하나 알아보자 로컬스토리지에는 문자,숫자만 저장가능하다고 했지만 arr,obj자료형도 강제로 저장을 할 수 있음
    // localStorage.setItem('num', [1, 2, 3])
    //이렇게 저장하고 로컬스토리지에서 보면 강제로 대괄호를 없애고 문자열로 저장한걸 볼 수 있음 
    //어떤 편법이냐?
    //arr,obj를 만들고 이걸 JSON으로 변경하면됨
    // let arr = [1, 2, 3]
    //let newarr2 = JSON.stringify(arr)
    // localStorage.setItem('num', newarr2)
    //이렇게 저장하면 이 데이터를 꺼내도 잘 저장이 되어있음
    // let getItem = localStorage.getItem('num')
    //다만 이거는 arr이 아니라 문자인걸 인지해야함
    //그래서 자료를 꺼내고 싶어도 
    //console.log(getItem[0]) //이렇게 꺼내면 [ 이거 하나 나옴
    //그래서 다시 arr,obj로 변경해줘야함
    //이렇게 변환해주면 인덱싱도 가능
    // console.log(JSON.parse(getItem)[0])
    //세션스토리지 사용법은 로컬스토리지와 동일하고 이름만 로컬 -> 세션으로 변경해주면 끝!
    //로컬스토리지 데이터를 수정하고 싶으면?
    //수정을 쉽게 해주는 함수나 훅은 없지만 3단계를 걸쳐 수정을 할 수 있음
    //1. 자료꺼내기 2. 꺼낸거 수정하기 3. 다시넣기 
    //숙제1. 구매버튼 누르면 누른 상품면 로컬스토리지에 저장하기
    //힌트 구매버튼을 누르면 내 형제요소 찾는 법 알아봐야함 
    //로컬스토리지가 비어있을 때/ 뭐가 있을 때 저장방식을 다르게 짜야함
    //숙제2. cart.html 방문시 local스토리지에 저장된 상품명들 다 보여주기
    var products = [
      { id: 0, price: 70000, title: 'Blossom Dress' },
      { id: 1, price: 50000, title: 'Springfield Shirt' },
      { id: 2, price: 60000, title: 'Black Monastery' }
    ];

    let noarr = []
    let arr = JSON.stringify(noarr)


    let cardlist = document.querySelector('.row');
    let clickcount = 0


    포이치(products);

    let cartSave = document.querySelectorAll('.buy')
    products.forEach((item, index) => {
      cartSave[index].addEventListener('click', () => {
        if (!noarr.includes(item.title)) {
          noarr.push(item.title)
          arr = JSON.stringify(noarr)
          localStorage.setItem('cart', arr)
        }
        else {
          alert('이미있음')
        }


      })
    })


    function 포이치(runArr) {
      runArr.forEach(item => {
        let secCardList = `<div class="col-sm-4">
        <img src="https://placehold.co/600" class="w-100">
        <h5>${item.title}</h5>
        <p>가격 : ${item.price}</p>
        <button class='buy'>구매</button>
      </div>`
        cardlist.insertAdjacentHTML('beforeend', secCardList)
      });
    }


    document.querySelector('#priceArr').addEventListener('click', () => {
      products.sort((a, b) => { return a.price - b.price });
      cardlist.innerHTML = ''
      포이치(products);
      clickcount = 0
      document.querySelector('#moreData').style.display = 'block'
    })

    document.querySelector('#namereturn').addEventListener('click', () => {
      products.sort((a, b) => {
        return a.title > b.title ? -1 : 1
      })
      cardlist.innerHTML = ''
      포이치(products);
      clickcount = 0
      document.querySelector('#moreData').style.display = 'block'
    })


    let newarr = products.filter((a) => { return a.price <= 60000 });
    document.querySelector('#priceUnder').addEventListener('click', () => {
      cardlist.innerHTML = ''
      포이치(newarr);
    })


    document.querySelector('#moreData').addEventListener('click', () => {
      if (clickcount == 0) {
        fetch('https://codingapple1.github.io/js/more1.json').then(response => {
          return response.json();
        }).then(data => {

          포이치(data)
        })
      }

      else if (clickcount == 1) {
        fetch('https://codingapple1.github.io/js/more2.json').then(response => {
          return response.json();
        }).then(data => {
          포이치(data)
        })
        document.querySelector('#moreData').style.display = 'none'
      }

      clickcount += 1
    })




    // //then은 말 그대로 응답이 오면~~~~(=비동기 작업이 끝나면) 아래에 작성한 내용 실행해~~이거임
    // fetch('https://codingapple1.github.io/price.json')
    //   .then(function (response) { // 1. 서버 응답(response) 받음
    //     //응답을 받는다라는 뜻은 URL로 요청을 보내면 거기에 있는 서버가 요청을 받고
    //     //서버가 준비한 데이터를 응답(response)으로 다시 내 브라우저에 보내줌
    //     //return response;  //그리고 이렇게 출력해보면 알지만 이상한 말들이 많은 그거를 text로 변환해서 내가 쓸 수 있게 바꾸려는작업
    //     // 리턴 필수임!!!!
    //     // return response.text(); // 2. 응답을 텍스트로 변환
    //     //다만 중요한 점이 있음 애초에 서버에는 JSON(문자열) 형태로 데이터가 저장되어있어서
    //     //넘어올 때 내가 어떻게 필요한지를 확인해야함 만약에 객체나 배열로 필요하면 json() 함수를 사용해서 JS객체로 변환 후 사용해야함
    //     return response.json();
    //   }).then(function (data) {     // 3. 변환된 데이터(data) 사용
    //     console.log(data.price);       // 실제 텍스트 출력
    //   });
    // fetch('https://codingapple1.github.io/hello.txt', {
    //   method: 'POST',
    //   headers: { 'Content-Type': 'application/json' }, //내가 어떤 형식의 데이터를 보낼거야 라고 알려주는 정보
    //   //'Content-Type': 'application/json' → "나는 JSON 형식으로 보낼 거야"라는 뜻
    //   body: JSON.stringify({ name: '홍길동' }) //바디는 서버로 실제로 "보내는 데이터" 예: { name: '홍길동' } 같은 객체를 보냄
    //   //하지만 서버는 문자열만 이해하므로, JSON.stringify({ name: '홍길동' })로 문자열로 바꿔서 보냄
    // }).then(function (response) { // 서버 응답(response) 받음
    //   //이곳에서 then으로 받아오는 응답은 내가 서버에 데이터를 보내더라도
    //   //그 서버에서 데이터를 잘 받았나 못받았나 에러가 났나 라는 정보들을 리턴해줌 그걸 받아오는 거임
    //   //그래서 서버에서는 항상 데이터 값을 JSON 파일로 줌
    //   return response.json();  // 응답을 JSON으로 변환
    //   //그래서 여기서 json() 훅을 사용해서 자바스크립트 객체로 변환하는 상태임
    //   //그 후에는 get처럼 아래에 데이터를 내가 꺼내서 볼 수 있게 하면 됨
    // }).then(function (data) {     // 변환된 데이터(data) 사용
    //   console.log(data);       // 실제 JSON 데이터 출력
    // }).catch(error => {
    //   console.log(error)
    // });
    // //전체적으로 보면 get이든 post든 첫번째 then에서는 정보를 .text나 .json등으로 변환만하고 실제로 데이터를 다루는 곳은 두번째 then에서 다룸
    // //이제 오류를 체크하려면 .catch() 를 쓰면 됨 .catch(error => {console.log(error)}); 이런식으로 쓰는데
    // //중요한 점은 catch는 then체인(전체 fetch요청) 마지막에 붙여서 모든 에러(네트워크,파싱 등)를 한 번에 처리하는 용도로 사용됨
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

</body>




</html>
